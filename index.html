<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Joffrey Bienvenu">
    <link rel="canonical" href="https://wallonia.ml">
    <title>Wallonia's 3D Houses</title>

    <link href="./assets/css/bootstrap.css" rel="stylesheet">
    <link href="./assets/css/dashboard.css" rel="stylesheet">
    <link href="./assets/css/style.css" rel="stylesheet">

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>
</head>
<body>

<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" id="site_title" href="https://wallonia.ml">
        <img src="./assets/img/logo.svg" class="site_logo" height="24px" width="24px" /><p>Wallonia.ml</p></a>
    <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
</header>

<div class="container-fluid" id="content">
    <div class="row" id="content-row">
        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">
                            <span data-feather="home"></span>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="file"></span>
                            Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="shopping-cart"></span>
                            Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="users"></span>
                            Customers
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="bar-chart-2"></span>
                            Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="layers"></span>
                            Integrations
                        </a>
                    </li>
                </ul>

                <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                    <span>Saved reports</span>
                    <a class="link-secondary" href="#" aria-label="Add a new report">
                        <span data-feather="plus-circle"></span>
                    </a>
                </h6>
                <ul class="nav flex-column mb-2">
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="file-text"></span>
                            Current month
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="file-text"></span>
                            Last quarter
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="file-text"></span>
                            Social engagement
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="file-text"></span>
                            Year-end sale
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <main class="col-md-9 ml-sm-auto col-lg-10">
            <canvas id="render" width="100%" height="100%"></canvas>
        </main>
    </div>
</div>

<script type="module">

    import * as THREE from './assets/js/three.r119.module.js';
    import { PLYLoader } from './assets/js/three/PLYLoader.module.js';
    import { PCDLoader } from './assets/js/three/PCDLoader.module.js';
    import { TrackballControls } from './assets/js/three/TrackballControls.module.js';

    let canvas, renderer, scene, camera, controls;

    init();
    animate();

    function init() {

        // Canvas definition
        canvas = document.getElementById('render');

        // Renderer definition
        renderer = new THREE.WebGLRenderer({canvas});
        renderer.setSize( window.innerWidth, window.innerHeight );

        // Scene definition
        scene = new THREE.Scene();

        // Camera's constants
        const fov = 70;
        const aspect = window.innerWidth / window.innerHeight;  // 2 the canvas default
        const near = 0.1;
        const far = 1000;
        camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
        camera.position.set(0, 0, 30);
        camera.lookAt(0, 0, 0);

        // Camera controls
        controls = new TrackballControls(camera, renderer.domElement);

        // Load objects
        const ply_loader = new PLYLoader();
        const pcd_loader = new PCDLoader();

        // Math position to translate objects (land min + max / 2)
        const tran_x = - (168418 + 168496) / 2
        const tran_y = - (147743 + 147821) / 2
        const tran_z = - (133 + 138) / 2

        // Load land PLY
        ply_loader.load('./assets/3d/land.ply', (geometry) => {
            geometry.computeVertexNormals(false);

            // Set mesh color and set double side (avoid see through)
            let material = new THREE.MeshBasicMaterial({color: 0x567d46, side: THREE.DoubleSide});
            let mesh = new THREE.Mesh(geometry, material);

            // Allow shadow and translate to (0, 0, 0)
            mesh.receiveShadow = true;
            mesh.geometry.translate(tran_x, tran_y, tran_z)

            scene.add(mesh);
        });

        // Load vegetation PCD
        pcd_loader.load('./assets/3d/vegetation.pcd', (points) => {

            // Set points size and color
            points.material.size = 0.5
            points.material.color.setHex(0x3A5F0B)

            // Translate to (0, 0, 0)
            points.geometry.translate(tran_x, tran_y, tran_z)
            scene.add(points);
        });

        console.log(scene)
    }

    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        render()
    }

    function render() {
        renderer.render( scene, camera );
    }

</script>
</body>
</html>
